<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="layouts/sub_layout">
<head>
    <meta charset="UTF-8">
    <title>Đặt xe trung chuyển</title>
    <style>
        .square-container {
            width: 490px;
            height: 300px;
           text-align: center;
        }

        .row-container {
            display: flex;
            justify-content: space-between;
            margin-top: 80px;
            margin-bottom: 75px;
        }
        .term-heading {
            font-weight: bold;
            font-size: 18px;
            margin-bottom: 10px;
        }

        .highlighted-text {
            background-color: #e0e059;
            font-weight: bold;
        }

        .highlighted-link {
            color: blue;
            font-weight: bold;
            text-decoration: underline;
        }


    </style>
    <link rel="shortcut icon" th:href="@{/img/favicon.svg}">
</head>
<body onload="getCurrentLocation()">
<div layout:fragment="content">
    <div class="row-container">
        <div class="container-fluid">
            <form th:action="@{/users/tickets/transit-form}" method="post" th:object="${shuttlebus}"
                  style="max-width: 500px; margin: 0 auto;">
                <input type="hidden" th:field="*{id}">
                <input type="hidden" th:field="*{booking}">
                <div class="border border-secondary rounded p-3">

                    <div class="form-group row">
                        <label class="col-sm-4 col-form-label">Tên liên hệ:</label>
                        <div class="col-sm-8">
                            <input type="text" th:field="*{name}" class="form-control" required maxlength="25"
                                   th:classappend="${#fields.hasErrors('name')} ? 'is-invalid' : ''">
                            <div class="invalid-feedback" th:errors="*{name}"></div>
                        </div>
                    </div>
                    <div class="form-group row">
                        <label class="col-sm-4 col-form-label">Nơi đón:</label>
                        <div class="col-sm-8">
                            <input type="text" id="address" name="address" th:field="*{address}" class="form-control"
                                   required
                                   th:classappend="${#fields.hasErrors('address')} ? 'is-invalid' : ''">
                            <div class="invalid-feedback" th:errors="*{address}"></div>
                        </div>
                    </div>

                    <div class="form-group row">
                        <label class="col-sm-4 col-form-label">Số điện thoại :</label>
                        <div class="col-sm-8">
                            <input type="text" pattern="(\+84|0)\d{9,10}" title="Vui lòng nhập số điện thoại hợp lệ"
                                   th:field="*{phone}" class="form-control" minlength="10" maxlength="12"
                                   min="0" required th:classappend="${#fields.hasErrors('phone')} ? 'is-invalid' : ''">
                            <div class="invalid-feedback" th:errors="*{phone}"></div>
                        </div>
                    </div>
                    <div class="text-center">
                        <button type="submit" class="btn btn-primary m-2">Gửi</button>
                        <button type="button" class="btn btn-secondary m-2" onclick="cancelForm()">Hủy</button>
                    </div>
                </div>

            </form>
        </div>

        <div class="container-fluid">
            <div class="border border-secondary rounded p-3 square-container">
                <p class="term-heading">LƯU Ý</p>
                <hr/>
                <p>
                    (*) Quý khách vui lòng mang email có chứa mã vé đến văn phòng để đổi vé lên xe trước giờ xuất bến ít
                    nhất
                    <span class="highlighted-text"> <strong>20 phút</strong> </span>
                </p>
                <p>
                    (*) Quý khách vui lòng điền thông tin trung chuyển vào mẫu này, hoặc liên hệ số điện thoại
                    <a class="highlighted-link">0345712873</a>
                    sau khi đặt vé. Chúng tôi không trung chuyển khách ở những nơi không đón được hoặc vượt quá bán kính
                    4km từ nhà xe
                </p>
            </div>
        </div>
    </div>

    <script type="text/javascript">
        function cancelForm() {
            window.location = "[[@{/home}]]";
        }
    </script>
    <script type="text/javascript">
        function getCurrentLocation() {
            if (navigator.geolocation) {
                //Nếu hàm getCurrentPosition() chạy thành công, thì nó trả về cho người dùng tọa độ vị trí thông qua hàm truyền tham số (showPosition)
                navigator.geolocation.getCurrentPosition(showPosition);
            } else {
                alert("Trình duyệt của bạn không hỗ trợ định vị");
            }
        }

        function showPosition(position) {
            var latitude = position.coords.latitude;
            var longitude = position.coords.longitude;
            var nominatimApiUrl = "https://nominatim.openstreetmap.org/reverse?format=json&lat=" + latitude + "&lon=" + longitude;

            $.ajax({
                url: nominatimApiUrl,
                type: "GET",
                dataType: "json",
                success: function (response) {
                    // Lấy thông tin địa chỉ từ response và gán vào ô input "address"
                    var address = response.display_name;
                    document.getElementById("address").value = address;
                },
                error: function (xhr, status, error) {
                    console.log("Error: " + error);
                }
            });

        }
    </script>

</div>
</div>
</body>
</html>
