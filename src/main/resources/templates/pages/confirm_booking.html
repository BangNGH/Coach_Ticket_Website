<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="layouts/sub_layout">
<head>
    <meta charset="UTF-8">
    <title>Xác nhận đặt vé</title>
    <style>
        .square-container {
            width: 490px; /* Điều chỉnh theo kích thước mong muốn */
            height: 450px;
            text-align: center;
        }

        .row-container {
            display: flex;
            justify-content: space-between;
            margin-top: 80px;
            margin-bottom: 75px;
        }

        .term-heading {
            font-weight: bold;
            font-size: 18px;
            margin-bottom: 10px;
        }

        .highlighted-text {
            background-color: #e0e059;
            font-weight: bold;
        }

        .highlighted-link {
            color: blue;
            font-weight: bold;
            text-decoration: underline;
        }

    </style>
    <link rel="shortcut icon" th:href="@{/img/favicon.svg}">
</head>
<body>
<div layout:fragment="content">
    <div class="row-container">
        <div class="container-fluid" th:if="${hasRoundTrip}">

            <form th:action="@{/users/save}" method="post" th:object="${roundTrip}"
                  style="max-width: 500px; margin: 0 auto;">
                <div th:if="${errorMessage}" class="alert alert-danger text-center">
                    [[${errorMessage}]]
                </div>
                <div class="border border-secondary rounded p-3">
                    <div class="mb-3 row">
                        <label class="col-sm-4 col-form-label">Tuyến đi:</label>
                        <div class="col-sm-8">
                            <input type="text" class="form-control" readonly th:value="${roundTrip.trip.route.name}">
                        </div>
                    </div>
                    <div class="mb-3 row">
                        <label class="col-sm-4 col-form-label">Loại xe:</label>
                        <div class="col-sm-8">
                            <input type="text" class="form-control" readonly th:value="${roundTrip.trip.vehicle.name}">
                        </div>
                    </div>
                    <div class="mb-3 row">
                        <label class="col-sm-4 col-form-label">Ngày đi:</label>
                        <div class="col-sm-8">
                            <input type="text" class="form-control" readonly name="date"
                                   th:value="${{#temporals.format(roundTrip.bookingDate, 'dd/MM/yyyy')}}">
                        </div>
                    </div>
                    <div class="mb-3 row">
                        <label class="col-sm-4 col-form-label">Thời gian: </label>
                        <div class="col-sm-8">
                            <input type="text" class="form-control" readonly th:value="${roundTrip.trip.startTime}">
                        </div>
                    </div>
                    <div class="mb-3 row">
                        <label class="col-sm-4 col-form-label font-weight-bold"
                               th:text="'Số ghế('+ ${seatsReserved.size()}+'): '"></label>
                        <div class="col-sm-8">
                            <span class="highlighted-text" th:each="sr, iterStat : ${roundTrip.seatReservations}">
                                <span th:text="${sr.seat.name}" th:value="${sr.seat.id}"></span>
                                <span th:if="${!iterStat.last}">, </span>
                                </span>
                        </div>
                    </div>

                    <div class="mb-3 row">
                        <label class="col-sm-4 col-form-label">Giá:</label>
                        <div class="col-sm-8">
                            <input type="text" class="form-control" readonly
                                   th:value="${#numbers.formatDecimal(roundTrip.trip.price, 0, 'COMMA', 0, 'POINT') + 'đ'}+' x '+ ${seatsReserved.size()} + ' vé ='+ ${#numbers.formatDecimal(roundTrip.trip.price * seatsReserved.size(), 0, 'COMMA', 0, 'POINT') + 'đ'}">
                        </div>
                    </div>
                </div>
            </form>
        </div>
        <div class="container-fluid">
            <form th:action="@{/users/save}" method="post" th:object="${trip}"
                  style="max-width: 500px; margin: 0 auto;">
                <input type="hidden" name="bookedId" th:value="${bookedId}">
                <input type="hidden" th:field="*{id}"/>
                <input type="hidden" th:field="*{route}"/>
                <input type="hidden" th:field="*{vehicle}"/>
                <input type="hidden" th:field="*{startTime}"/>
                <input type="hidden" th:field="*{price}"/>
                <input type="hidden" th:each="seat : ${seatsReserved}" th:name="'seatsReserved'" th:value="${seat.id}"/>
                <div th:if="${errorMessage}" class="alert alert-danger text-center">
                    [[${errorMessage}]]
                </div>
                <div class="border border-secondary rounded p-3">
                    <div class="mb-3 row">
                        <label class="col-sm-4 col-form-label">Tuyến:</label>
                        <div class="col-sm-8">
                            <input type="text" class="form-control" readonly th:value="${trip.route.name}">
                        </div>
                    </div>
                    <div class="mb-3 row">
                        <label class="col-sm-4 col-form-label">Loại xe:</label>
                        <div class="col-sm-8">
                            <input type="text" class="form-control" readonly th:value="${trip.vehicle.name}">
                        </div>
                    </div>
                    <div class="mb-3 row">
                        <label class="col-sm-4 col-form-label">Ngày :</label>
                        <div class="col-sm-8">
                            <input type="text" class="form-control" readonly id="date" name="date"
                                   th:value="${{#temporals.format(startTime, 'dd/MM/yyyy')}}">
                        </div>
                    </div>
                    <div class="mb-3 row">
                        <label class="col-sm-4 col-form-label">Thời gian: </label>
                        <div class="col-sm-8">
                            <input type="text" class="form-control" readonly th:value="${trip.startTime}">
                        </div>
                    </div>
                    <div class="mb-3 row">
                        <label class="col-sm-4 col-form-label font-weight-bold"
                               th:text="'Số ghế('+ ${seatsReserved.size()}+'): '"></label>
                        <div class="col-sm-8">
                            <span class="highlighted-text" th:each="sr, iterStat : ${seatsReserved}">
                                <span th:text="${sr.name}" th:value="${sr.id}"></span>
                                <span th:if="${!iterStat.last}">, </span>
                                </span>
                        </div>
                    </div>
                    <div class="mb-3 row">
                        <label class="col-sm-4 col-form-label">Giá:</label>
                        <div class="col-sm-8">
                            <input type="text" class="form-control" readonly
                                   th:value="${#numbers.formatDecimal(trip.price, 0, 'COMMA', 0, 'POINT') + 'đ'}+' x '+ ${seatsReserved.size()} + ' vé ='+ ${#numbers.formatDecimal(trip.price * seatsReserved.size(), 0, 'COMMA', 0, 'POINT') + 'đ'}">
                        </div>
                    </div>

                    <div th:if="${hasRoundTrip}" class="mb-3 row">
                        <label class="col-sm-4 col-form-label">Ghi chú lượt đi:</label>
                        <div class="col-sm-8">
                            <input type="text" name="noteRoundTrip" id="noteRoundTrip" class="form-control"
                                   placeholder="Thêm ghi chú cho chúng tôi ở đây." onfocus="this.placeholder = ''"
                                   onblur="this.placeholder = 'Bạn có thể thêm ghi chú cho chúng tôi ở đây.'">
                        </div>
                    </div>

                    <div class="mb-3 row">
                        <label class="col-sm-4 col-form-label"
                               th:text="${hasRoundTrip}?'Ghi chú lượt về:':'Ghi chú:'"></label>
                        <div class="col-sm-8">
                            <input type="text" name="note" id="note" class="form-control"
                                   placeholder="Thêm ghi chú cho chúng tôi ở đây." onfocus="this.placeholder = ''"
                                   onblur="this.placeholder = 'Bạn có thể thêm ghi chú cho chúng tôi ở đây.'">
                        </div>
                    </div>

                    <div class="form-group row">
                        <div class="col-sm-8 offset-sm-4">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="acceptTerms" required>
                                <label class="form-check-label" for="acceptTerms">Chấp nhận điều khoản của chúng
                                    tôi.</label>
                            </div>
                        </div>
                    </div>

                    <div class="text-center">
                        <button type="button" class="btn btn-secondary m-2" onclick="cancelForm()">Hủy</button>
                        <button type="submit" class="btn btn-primary m-2">Thanh toán</button>
                    </div>
                </div>
            </form>

        </div>

        <div class="container-fluid">
            <div class="border border-secondary rounded p-3 square-container">
                <p class="term-heading">ĐIỀU KHOẢN &amp; LƯU Ý</p>
                <hr/>
                <p>
                    (*) Quý khách vui lòng mang email có chứa mã vé đến văn phòng để đổi vé lên xe trước giờ xuất bến ít
                    nhất
                    <span class="highlighted-text"> <strong>20 phút</strong> </span> để thực hiện đổi vé
                </p>
                <p>(*) Thông tin hành khách phải chính xác, nếu không sẽ không thể lên xe hoặc hủy/đổi vé.</p>
                <p>
                    (*) Nếu quý khách có nhu cầu trung chuyển, vui lòng liên hệ số điện thoại
                    <a class="highlighted-link">0345712873</a>
                    , hoặc điền thông tin vào "Đặt vé trung chuyển sau khi thanh toán thành công. Chúng tôi không đón
                    tại những điểm xe trung chuyển không thể tới được
                    hoặc vượt quá bán kính 4km từ nhà xe
                </p>
            </div>

        </div>
    </div>

    <script type="text/javascript">
        // Lấy tham chiếu đến checkbox "acceptTerms"
        var acceptTermsCheckbox = document.getElementById('acceptTerms');
        // Lấy tham chiếu đến nút "Save"
        var saveButton = document.querySelector('button[type="submit"]');
        saveButton.disabled = true;
        // Gán sự kiện onchange cho checkbox
        acceptTermsCheckbox.addEventListener('change', function () {
            // Kiểm tra trạng thái của checkbox
            if (acceptTermsCheckbox.checked) {
                // Nếu checkbox đã được chọn, bỏ vô hiệu hóa nút "Save"
                saveButton.disabled = false;
            } else {
                // Nếu checkbox chưa được chọn, vô hiệu hóa nút "Save"
                saveButton.disabled = true;
            }
        });

        function cancelForm() {
            window.location = "[[@{/home}]]";
        }
    </script>
</div>
</div>
</body>
</html>
